pipeline{

 agent any

	parameters {
		gitParameter(branch: '', branchFilter: '.*', defaultValue: 'origin/master', description: 'Branch to take checkout and run  pipeline on', listSize: '10', name: 'checkoutBranch', quickFilterEnabled: true, selectedValue: 'NONE', sortMode: 'NONE', tagFilter: '*', type: 'PT_BRANCH')
	}

	stages{
		stage('checkout'){
			steps{
					checkout changelog: false, poll: false, scm: [$class: 'GitSCM', branches: [[name: "${params.checkoutBranch}"]], browser: [$class: 'GitLabBrowser'], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'CleanBeforeCheckout', deleteUntrackedNestedRepositories: true]], submoduleCfg: [], userRemoteConfigs: [[url: 'https://github.com/rudhrainfogain/Junit-test.git']]]
			}
		}

		stage('Build'){
			steps {
				echo "This is the build step"
				bat "mvn clean package verify"
			}
		}

		stage('SonarCube') {
			steps {
				script {
				    def pom = readMavenPom file: 'pom.xml'
                    projectVersion=pom.version
                    echo "Project Version: ${projectVersion}"			
					withSonarQubeEnv() {
						bat "mvn ${SONAR_MAVEN_GOAL}"
					}
				}
			}
		}

		stage("Sonar Quality Gate Analysis") {
			steps {
				echo "Analysis for Code Quality Results from Sonar Qube"
				timeout(time: 1, unit: 'HOURS') {
					// Parameter indicates whether to set pipeline to UNSTABLE if Quality Gate fails
					// true = set pipeline to UNSTABLE, false = don't
					waitForQualityGate abortPipeline: true
				}
			}
		}
	}
}